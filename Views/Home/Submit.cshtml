@model Contract_Monthly_Claim_System.Models.SubmitClaimsViewModel
@{
    ViewData["Title"] = "Submit Claims";
}

<div class="lecturer-info">
    @if (User.Identity.IsAuthenticated)
    {
        var lecturer = Model.Lecturer;
        <h2>Welcome, @lecturer.LecturerName @lecturer.LecturerSurname!</h2>
        <p><strong>Phone:</strong> @lecturer.LecturerPhone</p>
        <p><strong>Email:</strong> @User.Identity.Name</p>
    }
    else
    {
        <h2>Welcome, Guest!</h2>
        <p>Please log in to submit your claims.</p>
    }
</div>

<form asp-action="SubmitClaims" method="post" enctype="multipart/form-data">
    <div class="form-group">
        <label>Select Module</label>
        @* Update the module options here *@
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="Modules" value="PROG6212" id="module1" onchange="calculateTotal()">
            <label class="form-check-label" for="module1">PROG6212</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="Modules" value="DATA6222" id="module2" onchange="calculateTotal()">
            <label class="form-check-label" for="module2">DATA6222</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="Modules" value="HCIN6221" id="module3" onchange="calculateTotal()">
            <label class="form-check-label" for="module3">HCIN6221</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="Modules" value="IPMA6212" id="module4" onchange="calculateTotal()">
            <label class="form-check-label" for="module4">IPMA6212</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="Modules" value="SAND6221" id="module5" onchange="calculateTotal()">
            <label class="form-check-label" for="module5">SAND6221</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="Modules" value="WEDE6021" id="module6" onchange="calculateTotal()">
            <label class="form-check-label" for="module6">WEDE6021</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="Modules" value="ITPP5112" id="module7" onchange="calculateTotal()">
            <label class="form-check-label" for="module7">ITPP5112</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="Modules" value="OPSY5121" id="module8" onchange="calculateTotal()">
            <label class="form-check-label" for="module8">OPSY5121</label>
        </div>
        <small class="form-text text-muted">You can select multiple modules.</small>
    </div>

    <div class="form-group">
        <label for="HoursWorked">Hours Worked</label>
        <input type="number" class="form-control" id="HoursWorked" name="HoursWorked" min="1" max="200" required onchange="calculateTotal()">
    </div>

    <div class="form-group">
        <label for="HourlyRate">Hourly Rate (R)</label>
        <input type="number" class="form-control" id="HourlyRate" name="HourlyRate" step="0.01" value="0.00" min="50" max="1000" required onchange="calculateTotal()">
    </div>

    <div class="form-group">
        <label for="TotalClaimAmount">Total Claim Amount (R)</label>
        <input type="text" class="form-control" id="TotalClaimAmount" name="TotalClaimAmount" readonly>
    </div>

    <div class="form-group">
        <label for="AdditionalNotes">Additional Notes</label>
        <textarea class="form-control" id="AdditionalNotes" name="AdditionalNotes" rows="3"></textarea>
    </div>

    <div class="form-group">
        <label for="SupportingDocuments">Upload Supporting Document</label>
        <input type="file" class="form-control-file" id="SupportingDocuments" name="SupportingDocuments" accept=".pdf, .docx, .xlsx" required>
        <small class="form-text text-muted">Accepted formats: PDF, DOCX, XLSX. Max size: 5MB.</small>
        <div id="fileNameDisplay"></div>
    </div>

    <button type="submit" class="btn btn-primary submit-btn">Submit Claim</button>
</form>

<script>
    function calculateTotal() {
        const modules = document.querySelectorAll('input[name="Modules"]:checked');
        const hoursWorked = parseFloat(document.getElementById('HoursWorked').value) || 0;
        const hourlyRate = parseFloat(document.getElementById('HourlyRate').value) || 0;

        const moduleCount = modules.length;
        const totalClaimAmount = hoursWorked * hourlyRate * moduleCount;

        document.getElementById('TotalClaimAmount').value = totalClaimAmount.toFixed(2);
    }

    document.getElementById('SupportingDocuments').addEventListener('change', function () {
        const fileInput = this;
        const fileNameDisplay = document.getElementById('fileNameDisplay');
        const file = fileInput.files[0];

        if (file) {
            if (file.size > 5242880) {
                alert("File size exceeds 5MB. Please upload a smaller file.");
                fileInput.value = "";
                fileNameDisplay.innerHTML = "";
            } else {
                fileNameDisplay.innerHTML = "File uploaded: " + file.name;
            }
        }
    });
</script>

<!-- Custom styles for better UI -->
<style>
    .lecturer-info {
        background-color: #f1f1f1;
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        text-align: center;
    }

        .lecturer-info h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.75rem;
            color: #333;
        }

    .form-group {
        margin-bottom: 1rem;
    }

    .form-control,
    .form-control-file {
        padding: 0.75rem;
        border-radius: 5px;
        font-family: 'Open Sans', sans-serif;
    }

    .submit-btn {
        background-color: #DE1B38;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 5px;
        font-size: 1.1rem;
        font-family: 'Montserrat', sans-serif;
        transition: background-color 0.3s;
        display: block;
        width: 100%;
        cursor: pointer;
    }

        .submit-btn:hover {
            background-color: #87071a;
        }
</style>
